<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
	<head th:fragment="head">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- https://getbootstrap.com/docs/5.3/getting-started/download/ -->
		<link rel="stylesheet" th:href="@{/3rdp/bootstrap-5.3.8.min.css}">
		<script th:src="@{/3rdp/bootstrap-5.3.8.bundle.min.js}"></script>
		<!-- https://jquery.com/download/ -->
		<script th:src="@{/3rdp/jquery-3.7.1.min.js}"></script>
		<!-- ba√∫ -->
		<meta name="description" content="Ba√∫ do Z√©">
		<link rel="icon" type="image/x-icon" href="/favicon.ico">
		<link rel="stylesheet" href="/css/baudoze.css">
		<script th:src="@{/js/utils.js}"></script>
		<script>
			$(window).on('load', function() {
				$('#bau_exportar').click(async () => {
					const data = await $.ajax({ 
						type: "GET",
						dataType: "json",
						url: "/backupRestore/exportar",
						success: function(data){
							debugger;
							StringUtils.downloadString(JSON.stringify(data), `todo.${DateUtils.formatYYYYMMDDHHNNSS(new Date())}.json`);
							// TODO Trazer frontend do projeto "todo"
							frontend.addMessage('success', '', 'Exporta√ß√£o feita com sucesso.');
						}
						// TODO Tratar erro
					});
				});
			});
		</script>
	</head>
	<body>
		<!-- Header -->
		<nav th:fragment="nav" class="navbar navbar-expand-sm navbar-dark bg-dark d-print-none">
			<div class="container-fluid">
				<a class="navbar-brand" href="/"><img src="/img/bau-16.png"> Ba√∫ do Z√©</a>
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbar">
					<ul class="navbar-nav flex-row flex-wrap bd-navbar-nav">
						<li class="nav-item">
							<a class="nav-link" href="/biblia"><img src="/img/biblia-16.png"> B√≠blias</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="/tarefa"><img src="/img/tarefa-16.png"> Tarefas</a>
						</li>
					</ul>
					<ul class="navbar-nav flex-row flex-wrap ms-md-auto">
						<li class="nav-item dropdown">
							<a class="d-block nav-link dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><img src="/img/backup-restore-16.png"> Backup/Restore</a>
							<ul class="dropdown-menu dropdown-menu-end text-small">
								<li><a id="bau_exportar" class="dropdown-item">Exportar</a></li>
								<li><a id="bau_importar" class="dropdown-item">Importar</a></li>
								<li><a id="bau_limpar" class="dropdown-item">Limpar</a></li>
							</ul>
						</li>
					</ul>
					<ul class="navbar-nav ms-3">
						<li class="nav-item d-flex align-items-center">
							<img th:src="${authUserPicture}" class="rounded-circle me-2" style="width: 35px; height: 35px; object-fit: cover;">
							<span class="navbar-text me-3" th:text="${authUserName}"></span>
						</li>
					</ul>
				</div>
			</div>
		</nav>
		<div th:fragment="mensagens" id="mensagens" class="mt-3">
			<!-- exception -->
			<dl th:if="${exception != null}">
				<div class="alert alert-danger alert-dismissible">
					<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
					<h1>ERRO üò¨</h1>
					<dt>Exception</dt>
					<dd th:text="${exception.class.name}"></dd>
					<dt>Message</dt>
					<dd th:text="${exception.message}"></dd>
					<dt>
						<a data-bs-toggle="collapse" href="#exceptionStackTrace" role="button" aria-expanded="false" aria-controls="exceptionStackTrace">Stack trace</a>
					</dt>
					<dd class="collapse" id="exceptionStackTrace">
						<pre><code th:text="${#strings.listJoin(exception.stackTrace,'&#10;')}"></code></pre>
					</dd>
				</div>
			</dl>
		</div>
		<!-- Footer -->
		<footer th:fragment="footer" class="bg-dark d-print-none">
			<p class="text-center text-white">Este c√≥digo √© livre e pode ser baixado do <a href="https://github.com/zcla/baudoze" target="_blank">GitHub<img class="align-text-bottom" src="/img/linkExterno.svg"></a>.</p>
		</footer>
	</body>
</html>
